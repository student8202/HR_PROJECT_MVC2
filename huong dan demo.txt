Ch√†o b·∫°n, ƒë√¢y l√† b·∫£n t·ªïng h·ª£p to√†n di·ªán t·ª´ ƒë·∫ßu ƒë·∫øn cu·ªëi. Source code n√†y ƒë√£ t√≠ch h·ª£p ƒë·∫ßy ƒë·ªß: MVC Architecture, SQL Server (pyodbc), Bootstrap 5, DataTables (Ti·∫øng Vi·ªát), SweetAlert2 (CRUD Ajax), v√† Live Search.
1. C·∫•u tr√∫c th∆∞ m·ª•c (Chu·∫©n MVC)
MVC
HR_PROJECT/
‚îú‚îÄ‚îÄ app.py              # C·∫•u h√¨nh Flask & Register Blueprints
‚îú‚îÄ‚îÄ database.py         # K·∫øt n·ªëi SQL Server
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îî‚îÄ‚îÄ employee_ctl.py # X·ª≠ l√Ω Logic & G·ªçi SQL
‚îÇ   ‚îî‚îÄ‚îÄ department_ctl.py # X·ª≠ l√Ω Logic & G·ªçi SQL
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îî‚îÄ‚îÄ employee_view.py# ƒê·ªãnh nghƒ©a Routes (API & Giao di·ªán)
‚îÇ   ‚îî‚îÄ‚îÄ department_view.py# ƒê·ªãnh nghƒ©a Routes (API & Giao di·ªán)
‚îî‚îÄ‚îÄ templates/
    ‚îî‚îÄ‚îÄ index.html      # Giao di·ªán duy nh·∫•t (Bootstrap + JS)
    ‚îî‚îÄ‚îÄ employee.html
    ‚îî‚îÄ‚îÄ department.html
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îî‚îÄ‚îÄ main.js 
H√£y th·∫≠n tr·ªçng khi s·ª≠ d·ª•ng m√£.
Format Visual Shift + Alt + F
2. Chi ti·∫øt M√£ ngu·ªìn
üìÇ database.py
import pyodbc

def get_db_connection():
    conn_str = (
        'DRIVER={ODBC Driver 17 for SQL Server};'
        'SERVER=localhost;DATABASE=SMILE_HR;UID=smile;PWD=AnhMinh167TruongDinh;'
    )
    return pyodbc.connect(conn_str)
H√£y th·∫≠n tr·ªçng khi s·ª≠ d·ª•ng m√£.

üìÇ controllers/employee_ctl.py
python
from database import get_db_connection

class EmployeeController:
    @staticmethod
    def get_all():
        with get_db_connection() as conn:
            cursor = conn.cursor()
            cursor.execute("""
                SELECT E.ID, E.FullName, D.DeptName, E.IdDepartment 
                FROM Employees E LEFT JOIN Departments D ON E.IdDepartment = D.DeptID
            """)
            return [dict(zip([col[0] for col in cursor.description], row)) for row in cursor.fetchall()]

    @staticmethod
    def save(data):
        with get_db_connection() as conn:
            cursor = conn.cursor()
            if data.get('ID'):
                cursor.execute("UPDATE Employees SET FullName=?, IdDepartment=? WHERE ID=?", 
                               (data['FullName'], data['IdDepartment'], data['ID']))
            else:
                cursor.execute("INSERT INTO Employees (FullName, IdDepartment) VALUES (?, ?)", 
                               (data['FullName'], data['IdDepartment']))
            conn.commit()

    @staticmethod
    def delete(id):
        with get_db_connection() as conn:
            cursor = conn.cursor()
            cursor.execute("DELETE FROM Employees WHERE ID=?", (id,))
            conn.commit()
H√£y th·∫≠n tr·ªçng khi s·ª≠ d·ª•ng m√£.

üìÇ views/employee_view.py
python
from flask import Blueprint, jsonify, request
from controllers.employee_ctl import EmployeeController

employee_bp = Blueprint('employee', __name__)

@employee_bp.route('/api/employees', methods=['GET'])
def get_emps(): return jsonify(EmployeeController.get_all())

@employee_bp.route('/api/employees/save', methods=['POST'])
def save_emp():
    EmployeeController.save(request.json)
    return jsonify({"status": "success"})

@employee_bp.route('/api/employees/delete/<int:id>', methods=['DELETE'])
def del_emp(id):
    EmployeeController.delete(id)
    return jsonify({"status": "success"})
H√£y th·∫≠n tr·ªçng khi s·ª≠ d·ª•ng m√£.
-----------------------------------------------------------------------------
üìÇ controllers/department_ctl.py
python
from database import get_db_connection

class DepartmentController:
    @staticmethod
    def get_all():
        with get_db_connection() as conn:
            cursor = conn.cursor()
            cursor.execute("SELECT * FROM Departments")
            return [dict(zip([col[0] for col in cursor.description], row)) for row in cursor.fetchall()]

    @staticmethod
    def save(data):
        with get_db_connection() as conn:
            cursor = conn.cursor()
            if data.get('DeptID'):
                cursor.execute("UPDATE Departments SET DeptName=? WHERE DeptID=?", (data['DeptName'], data['DeptID']))
            else:
                cursor.execute("INSERT INTO Departments (DeptName) VALUES (?)", (data['DeptName'],))
            conn.commit()

    @staticmethod
    def delete(dept_id):
        with get_db_connection() as conn:
            cursor = conn.cursor()
            
            # B∆Ø·ªöC 1: Ki·ªÉm tra xem c√≥ nh√¢n vi√™n n√†o thu·ªôc b·ªô ph·∫≠n n√†y kh√¥ng
            cursor.execute("SELECT COUNT(*) FROM Employees WHERE IdDepartment = ?", (dept_id,))
            count = cursor.fetchone()[0]
            
            if count > 0:
                # Tr·∫£ v·ªÅ False ho·∫∑c b√°o l·ªói n·∫øu c√≤n nh√¢n vi√™n
                return False, f"Kh√¥ng th·ªÉ x√≥a! ƒêang c√≥ {count} nh√¢n vi√™n thu·ªôc b·ªô ph·∫≠n n√†y."
            
            # B∆Ø·ªöC 2: N·∫øu kh√¥ng c√≥ nh√¢n vi√™n, ti·∫øn h√†nh x√≥a
            cursor.execute("DELETE FROM Departments WHERE DeptID = ?", (dept_id,))
            conn.commit()
            return True, "X√≥a b·ªô ph·∫≠n th√†nh c√¥ng."
H√£y th·∫≠n tr·ªçng khi s·ª≠ d·ª•ng m√£.

üìÇ views/department_view.py
python
from flask import Blueprint, jsonify, request
from controllers.department_ctl import DepartmentController

department_bp = Blueprint('department', __name__)

@department_bp.route('/api/departments', methods=['GET'])
def get_depts(): return jsonify(DepartmentController.get_all())

@department_bp.route('/api/departments/save', methods=['POST'])
def save_dept():
    DepartmentController.save(request.json)
    return jsonify({"status": "success"})

@department_bp.route('/api/departments/delete/<int:id>', methods=['DELETE'])
def del_dept(id):
    success, message = DepartmentController.delete(id)
    if success:
        return jsonify({"status": "success", "message": message}), 200
    else:
        # Tr·∫£ v·ªÅ l·ªói 400 k√®m tin nh·∫Øn c·∫£nh b√°o
        return jsonify({"status": "error", "message": message}), 400
H√£y th·∫≠n tr·ªçng khi s·ª≠ d·ª•ng m√£.
-----------------------------------------------------------------------------
üìÇ templates/index.html
html
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Manager Pro</title>
    <!-- 1. Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 2. DataTables CSS cho Bootstrap 5 -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <!-- 3. DataTables Buttons CSS (Xu·∫•t file) -->
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.2.3/css/buttons.dataTables.min.css">
    <!-- Include Select2 CSS from jsDelivr -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
<div class="container mt-4 card shadow p-0">
        <ul class="nav nav-tabs bg-white">
            <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#emp-tab">Nh√¢n vi√™n</a></li>
            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#dept-tab">B·ªô ph·∫≠n</a></li>
        </ul>
        <div class="tab-content">
            <div id="emp-tab" class="tab-pane fade show active">{% include 'employee.html' %}</div>
            <div id="dept-tab" class="tab-pane fade">{% include 'department.html' %}</div>
        </div>
    </div>

<!-- Scripts: JQuery, Bootstrap, DataTables, SWAL2 -->
<!-- 1. jQuery -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<!-- 2. Bootstrap 5 Bundle JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- 3. DataTables Core & Bootstrap 5 -->
<!-- DataTables Core JS -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<!-- DataTables Bootstrap 5 JS -->
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<!-- 4. DataTables Buttons & Xu·∫•t File (Excel/PDF/Print) -->
<!-- Buttons Extension -->
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>

<!-- Th∆∞ vi·ªán h·ªó tr·ª£ xu·∫•t file -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<!-- 5. SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Include Select2 JS from jsDelivr -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<!-- LOAD FILE JS RI√äNG -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
<!-- Nh√∫ng Bootstrap Bundle JS (bao g·ªìm Popper) tr∆∞·ªõc th·∫ª </body> -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
H√£y th·∫≠n tr·ªçng khi s·ª≠ d·ª•ng m√£.
üìÇ templates/employee.html
html
<div class="p-3">
    <button class="btn btn-primary mb-3" onclick="openEmpModal()">+ Th√™m nh√¢n vi√™n</button>
    <table id="empTable" class="table table-striped table-bordered w-100">
        <thead>
            <tr><th>ID</th><th>H·ªç T√™n</th><th>B·ªô Ph·∫≠n</th><th>Thao t√°c</th></tr>
        </thead>
    </table>
</div>

<div class="modal fade" id="empModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5>Nh√¢n vi√™n</h5></div>
            <div class="modal-body">
                <input type="hidden" id="empId">
                <input type="text" id="empName" class="form-control mb-2" placeholder="H·ªç t√™n">
                <div class="mb-3">
                    <label class="form-label">Ch·ªçn B·ªô ph·∫≠n</label>
                    <select id="empDeptSelect" class="form-control select2-searchable">
                        <option value="">ƒêang t·∫£i d·ªØ li·ªáu...</option>
                    </select>
                </div>
                <!-- <select id="empDeptSelect" class="form-select select2-enable"></select> -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveEmp()">L∆∞u</button>
            </div>
        </div>
    </div>
</div>
üìÇ templates/department.html
html
<div class="p-3">
    <button class="btn btn-success mb-3" onclick="openDeptModal()">+ Th√™m b·ªô ph·∫≠n</button>
    <table id="deptTable" class="table table-striped table-bordered w-100">
        <thead>
            <tr><th>ID</th><th>T√™n b·ªô ph·∫≠n</th><th>Thao t√°c</th></tr>
        </thead>
    </table>
</div>

<div class="modal fade" id="deptModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5>B·ªô ph·∫≠n</h5></div>
            <div class="modal-body">
                <input type="hidden" id="deptId">
                <input type="text" id="deptName" class="form-control" placeholder="T√™n b·ªô ph·∫≠n">
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="saveDept()">L∆∞u</button>
            </div>
        </div>
    </div>
</div>
üìÇ static/js/main.js
let empTable, deptTable;

$(document).ready(function () {
    // Init Tables
    const dtConfig = {
        dom: 'Bfrtip',
        buttons: ['copy', 'excel', 'pdf', 'print']
    };

    empTable = $('#empTable').DataTable({
        ...dtConfig,
        ajax: { url: '/api/employees', dataSrc: '' },
        columns: [
            { data: 'ID' },
            { data: 'FullName' },
            { data: 'DeptName' },
            {
                data: 'ID',
                render: function (data, type, row) {
                    return `
                                <button class="btn btn-sm btn-warning" onclick='editEmp(${JSON.stringify(row)})'>S·ª≠a</button>
                                <button class="btn btn-sm btn-danger" onclick='delEmp(${JSON.stringify(row)})'>X√≥a</button>
                            `;
                }
            }
        ]
    });

    deptTable = $('#deptTable').DataTable({
        ...dtConfig,
        ajax: { url: '/api/departments', dataSrc: '' },
        columns: [
            { data: 'DeptID' },
            { data: 'DeptName' },
            {
                data: 'DeptID',
                render: function (data, type, row) {
                    return `
                                <button class="btn btn-sm btn-warning" onclick='editDept(${JSON.stringify(row)})'>S·ª≠a</button>
                                <button class="btn btn-sm btn-danger" onclick='delDept(${JSON.stringify(row)})'>X√≥a</button>
                            `;
                }
            }
        ]
    });

    loadDeptsToDropdown();
});

function loadDeptsToDropdown() {
    $.ajax({
        url: '/api/departments',
        type: 'GET',
        success: function (data) {
            let html = '<option value="">-- T√¨m v√† ch·ªçn b·ªô ph·∫≠n --</option>';
            data.forEach(d => {
                html += `<option value="${d.DeptID}">${d.DeptName}</option>`;
            });

            // ƒê·ªï d·ªØ li·ªáu v√†o select
            const $select = $('#empDeptSelect');
            $select.html(html);

            // Kh·ªüi t·∫°o Select2 v·ªõi t√≠nh nƒÉng t√¨m ki·∫øm
            $select.select2({
                theme: 'bootstrap-5', // N·∫øu b·∫°n d√πng b·∫£n Select2 bootstrap theme
                placeholder: 'G√µ ƒë·ªÉ t√¨m b·ªô ph·∫≠n...',
                allowClear: true,
                width: '100%',
                // QUAN TR·ªåNG: C·∫ßn d√≤ng n√†y ƒë·ªÉ search ƒë∆∞·ª£c khi n·∫±m trong Bootstrap Modal
                dropdownParent: $('#empModal')
            });
        },
        error: function () {
            Swal.fire('L·ªói', 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch b·ªô ph·∫≠n', 'error');
        }
    });
}

// Functions for Employee
function openEmpModal() { $('#empId').val(''); $('#empModal').modal('show'); }
function saveEmp() {
    $.ajax({
        url: '/api/employees/save', type: 'POST', contentType: 'application/json',
        data: JSON.stringify({ FullName: $('#empName').val(), IdDepartment: $('#empDeptSelect').val() }),
        success: () => { $('#empModal').modal('hide'); empTable.ajax.reload(); Swal.fire('Xong!', '', 'success'); }
    });
}
function delEmp(id) {
    if (confirm('X√≥a?')) $.ajax({ url: `/api/employees/delete/${id}`, type: 'DELETE', success: () => empTable.ajax.reload() });
}
function delEmp(row) {
    Swal.fire({
        title: 'X√°c nh·∫≠n x√≥a?',
        html: `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√¢n vi√™n <br><b>${row.FullName}</b> (ID: ${row.ID}) kh√¥ng?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'V√¢ng, x√≥a ngay!',
        cancelButtonText: 'H·ªßy',
        reverseButtons: true
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: `/api/employees/delete/${row.ID}`,
                type: 'DELETE',
                success: function () {
                    empTable.ajax.reload();
                    Swal.fire('ƒê√£ x√≥a!', `Nh√¢n vi√™n <b>${row.FullName}</b> ƒë√£ b·ªã x√≥a.`, 'success');
                },
                error: () => Swal.fire('L·ªói', 'Kh√¥ng th·ªÉ x√≥a d·ªØ li·ªáu', 'error')
            });
        }
    });
}
// Functions for Department
function openDeptModal() { $('#deptId').val(''); $('#deptModal').modal('show'); }
function saveDept() {
    $.ajax({
        url: '/api/departments/save', type: 'POST', contentType: 'application/json',
        data: JSON.stringify({ DeptName: $('#deptName').val() }),
        success: () => { $('#deptModal').modal('hide'); deptTable.ajax.reload(); loadDeptsToDropdown(); }
    });
}
function delDept(id) {
    if (confirm('X√≥a?')) $.ajax({ url: `/api/departments/delete/${id}`, type: 'DELETE', success: () => deptTable.ajax.reload() });
}
function delDept(row) {
    Swal.fire({
        title: 'X√°c nh·∫≠n x√≥a b·ªô ph·∫≠n?',
        html: `B·∫°n mu·ªën x√≥a b·ªô ph·∫≠n: <b>${row.DeptName}</b>?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        confirmButtonText: 'ƒê·ªìng √Ω x√≥a',
        cancelButtonText: 'H·ªßy'
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: `/api/departments/delete/${row.DeptID}`,
                type: 'DELETE',
                success: function (response) {
                    deptTable.ajax.reload();
                    loadDeptsToDropdown();
                    Swal.fire('ƒê√£ x√≥a!', response.message, 'success');
                },
                error: function (xhr) {
                    // L·∫•y tin nh·∫Øn l·ªói t·ª´ server (V√≠ d·ª•: "Kh√¥ng th·ªÉ x√≥a! ƒêang c√≥ 5 nh√¢n vi√™n...")
                    const errorMsg = xhr.responseJSON ? xhr.responseJSON.message : 'L·ªói h·ªá th·ªëng!';
                    Swal.fire({
                        title: 'C·∫£nh b√°o!',
                        text: errorMsg,
                        icon: 'error',
                        confirmButtonColor: '#3085d6'
                    });
                }
            });
        }
    });
}
// --- H√ÄM X·ª¨ L√ù S·ª¨A (EDIT) ---

function editEmp(row) {
    $('#empId').val(row.ID); // G√°n ID v√†o hidden input
    $('#empName').val(row.FullName);
    // C·∫≠p nh·∫≠t Select2
    $('#empDeptSelect').val(row.IdDepartment).trigger('change');
    $('#empModal').modal('show');
}

function editDept(row) {
    $('#deptId').val(row.DeptID); // G√°n ID v√†o hidden input
    $('#deptName').val(row.DeptName);
    $('#deptModal').modal('show');
}

// --- C·∫¨P NH·∫¨T H√ÄM SAVE (ƒê·ªÉ g·ª≠i c·∫£ ID khi s·ª≠a) ---

function saveEmp() {
    const payload = {
        ID: $('#empId').val(), // N·∫øu c√≥ ID l√† s·ª≠a, kh√¥ng c√≥ l√† th√™m m·ªõi
        FullName: $('#empName').val(),
        IdDepartment: $('#empDeptSelect').val()
    };
    $.ajax({
        url: '/api/employees/save',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(payload),
        success: function () {
            $('#empModal').modal('hide');
            empTable.ajax.reload();
            Swal.fire('Th√†nh c√¥ng!', 'D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t', 'success');
        }
    });
}
üìÇ app.py
python
from flask import Flask,render_template
from views.employee_view import employee_bp
from views.department_view import department_bp 
from waitress import serve
import os


app = Flask(__name__)
app.config['JSON_AS_ASCII'] = False
app.secret_key = "hr_pro_key"

# --- TH√äM ƒêO·∫†N N√ÄY ---
@app.route('/')
def index():
    return render_template('index.html')
# ---------------------
app.register_blueprint(employee_bp)
app.register_blueprint(department_bp)

app.config['DEBUG'] = True

if __name__ == '__main__':
    port = int(os.environ.get('PORT', 6066))
    print(f"SMILE HR MVC2 Service is running on port {port}...")
    serve(app, host='127.0.0.1', port=port)
H√£y th·∫≠n tr·ªçng khi s·ª≠ d·ª•ng m√£.

3. H∆∞·ªõng d·∫´n ch·∫°y
C√†i th∆∞ vi·ªán: pip install flask pyodbc
Kh·ªüi t·∫°o Database:
sql
CREATE TABLE [dbo].[Employees]
(
[ID] [int] NOT NULL IDENTITY(1, 1),
[FullName] [nvarchar] (100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[Department] [nvarchar] (50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[IdDepartment] [int] NULL
)
CREATE TABLE [dbo].[Departments]
(
[DeptID] [int] NOT NULL IDENTITY(1, 1),
[DeptName] [nvarchar] (100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL
)
H√£y th·∫≠n tr·ªçng khi s·ª≠ d·ª•ng m√£.

Ch·∫°y ·ª©ng d·ª•ng: M·ªü CMD trong th∆∞ m·ª•c d·ª± √°n v√† g√µ python app.py
-----------------------------------------------------
nssm install SMILE_HR_MVC
N·∫øu ch·∫°y, h√£y v√†o nssm edit SMILE_HR_Python, s·ª≠a:
Path: C:\SMILE PMS\HR_PROJECT_MVC\run_app.bat
Startup directory: C:\SMILE PMS\HR_PROJECT_MVC
Arguments: (ƒê·ªÉ tr·ªëng)

Sang tab I/O.
T·∫°i √¥ Output (stdout) v√† Error (stderr), h√£y ch·ªçn ƒë∆∞·ªùng d·∫´n: C:\SMILE PMS\HR_PROJECT_MVC\log_nssm.txt

